{% extends "base/header.j2" %}

{% block content %}
#include "blob.h"

static inline void dispatch(const indexed_call_t *packed, void *ret_v) {
    switch (packed->func) {
        {% for f in functions %}
        #ifndef skip_index_{{ f.name }}
        case {{ f.name }}_INDEX: {
            INDEXED_{{ f.types }} *unpacked = (INDEXED_{{ f.types }} *)packed;
            {% if f.args %}
            ARGS_{{ f.types }} args = unpacked->args;
            {% endif %}
            {% if not f.void %}
            {{ f.return }} *ret = ({{ f.return }} *)ret_v;
            *ret =
            {% endif %}
            {{ f.name }}({% for arg in f.args -%}
                args.a{{ loop.index }}{% if not arg.last %}, {% endif %}
            {% endfor %});
            break;
        }
        #endif
        {% endfor %}
    }
}

void glIndexedCall(blob_t *blob, void *ret_v) {
    blob_iter(blob);
    const indexed_call_t *packed;
    while ((packed = (indexed_call_t *)blob) != NULL) {
        dispatch(packed, ret_v);
    }
    blob_reset(blob);
}

{% endblock %}
